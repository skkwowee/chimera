# Chimera — Extraction Progress

Two standalone repos are being extracted from chimera:
1. **cs2-demo-viewer** — the Next.js demo viewer (from `site/`)
2. **cs2-tools** — Python demo processing tools (from `src/` and `scripts/`)

---

## Viewer extraction (cs2-demo-viewer)

**Source:** `~/chimera/site/`
**Tech:** Next.js 16, React 19, Tailwind v4
**Components:** MapCanvas.tsx (radar + vision cones + kill lines), DemoSelector.tsx,
TimelineSlider.tsx, viewer/page.tsx
**Data consumed:** `public/viewer-data/{demo}/round_XX.json`, `public/maps/*.png`
**Data is gitignored** in chimera (generated by `scripts/export_viewer_data.py`)

### Pipeline status
- [x] F01 — Extract site/ into standalone repo (git subtree split) — `cs2-demo-viewer/EXTRACT.sh`
- [x] F02 — Rename and rebrand (package.json, metadata) — `cs2-demo-viewer/package.json`, `layout.tsx`, `page.tsx`
- [x] F03 — Add sample data and data format docs — `cs2-demo-viewer/docs/data-format.md`
- [x] F04 — Write README for standalone repo — `cs2-demo-viewer/README.md`
- [x] F05 — Clean up chimera repo reference — README.md updated with links

### Key decisions
- Using git subtree split to preserve commit history
- Data-agnostic: no demo data shipped, just format docs + tiny sample
- Export script (`export_viewer_data.py`) stays in chimera, not the viewer repo
- `parse_demos.py` also stays in chimera

### How to publish

```bash
# From chimera repo root:
bash cs2-demo-viewer/EXTRACT.sh git@github.com:skkwowee/cs2-demo-viewer.git
```

This runs `git subtree split`, creates a new directory, applies rebranding, and pushes to the remote.

### Data format (for docs in F03)

**public/viewer-data/index.json** — Array of: `{ stem, map_name, rounds }`

**public/viewer-data/{demo}/meta.json** — `{ stem, map_name, header, rounds, kills, damages, shots, bomb }`

**public/viewer-data/{demo}/round_XX.json** — `{ round_num, start_tick, end_tick, freeze_end, winner, reason, bomb_plant_tick, bomb_site, frames: [{ tick, players: [{ name, side, x, y, z, yaw, hp, alive }] }] }`

**public/maps/** — `{map_name}.png`, `{map_name}_lower.png` (radar images), `map-data.json` (coordinate transform metadata)

---

## Tools extraction (cs2-tools)

**Files moving to cs2-tools:**
- `src/netcon.py` — TCP console driver for CS2 demo playback
- `scripts/parse_demos.py` — Parse .dem files via awpy into Parquet + metadata
- `scripts/export_viewer_data.py` — Export parsed data to viewer JSON format
- `scripts/plan_captures.py` — Generate capture plans (tick + POV sampling)
- `scripts/capture_screenshots.py` — Drive CS2 demo playback to capture JPEGs

**Files staying in chimera:**
- `src/data/manifest.py` — chimera-specific data manifest
- `src/rewards.py` — GRPO reward functions
- `scripts/` training-related scripts (future)
- `site/` — stays in chimera even after viewer extraction

### Pipeline status
- [x] T01 — Inventory tools and fix imports — `parse_demos.py` manifest import now conditional, `capture_screenshots.py` netcon import has fallback
- [x] T02 — Create cs2-tools repo and copy files — `cs2-tools/cs2_tools/` package with all 5 adapted files
- [x] T03 — Add pyproject.toml with optional deps — `cs2-tools/pyproject.toml` with `[parse]` extra for awpy/polars/pyarrow
- [x] T04 — Write README for cs2-tools — `cs2-tools/README.md` with usage examples for all tools
- [x] T05 — Clean up chimera repo references — README.md updated with links

### How to publish

```bash
# From chimera repo root:
bash cs2-tools/EXTRACT.sh git@github.com:skkwowee/cs2-tools.git
```

This copies the package directory, initializes git, and pushes to the remote.

---

## Decision logging convention

All significant technical decisions go in `docs/decisions.md` with sequential IDs (D001, D002, ...). Each entry includes: decision, rationale, alternatives considered, and status. Check current decision count with:

```bash
grep -c '^## D[0-9]' docs/decisions.md
```
