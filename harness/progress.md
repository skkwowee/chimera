# Chimera — Extraction Progress

Two standalone repos are being extracted from chimera:
1. **cs2-demo-viewer** — the Next.js demo viewer (from `site/`)
2. **cs2-tools** — Python demo processing tools (from `src/` and `scripts/`)

---

## Viewer extraction (cs2-demo-viewer)

**Source:** `~/chimera/site/`
**Tech:** Next.js 16, React 19, Tailwind v4
**Components:** MapCanvas.tsx (radar + vision cones + kill lines), DemoSelector.tsx,
TimelineSlider.tsx, viewer/page.tsx
**Data consumed:** `public/viewer-data/{demo}/round_XX.json`, `public/maps/*.png`
**Data is gitignored** in chimera (generated by `scripts/export_viewer_data.py`)

### Pipeline status
- [ ] F01 — Extract site/ into standalone repo (git subtree split)
- [ ] F02 — Rename and rebrand (package.json, metadata)
- [ ] F03 — Add sample data and data format docs
- [ ] F04 — Write README for standalone repo
- [ ] F05 — Clean up chimera repo reference

### Key decisions
- Using git subtree split to preserve commit history
- Data-agnostic: no demo data shipped, just format docs + tiny sample
- Export script (`export_viewer_data.py`) stays in chimera, not the viewer repo
- `parse_demos.py` also stays in chimera

### Data format (for docs in F03)

**public/viewer-data/index.json** — Array of: `{ stem, map_name, rounds }`

**public/viewer-data/{demo}/meta.json** — `{ stem, map_name, header, rounds, kills, damages, shots, bomb }`

**public/viewer-data/{demo}/round_XX.json** — `{ round_num, start_tick, end_tick, freeze_end, winner, reason, bomb_plant_tick, bomb_site, frames: [{ tick, players: [{ name, side, x, y, z, yaw, hp, alive }] }] }`

**public/maps/** — `{map_name}.png`, `{map_name}_lower.png` (radar images), `map-data.json` (coordinate transform metadata)

---

## Tools extraction (cs2-tools)

**Files moving to cs2-tools:**
- `src/netcon.py` — TCP console driver for CS2 demo playback
- `scripts/parse_demos.py` — Parse .dem files via awpy into Parquet + metadata
- `scripts/export_viewer_data.py` — Export parsed data to viewer JSON format
- `scripts/plan_captures.py` — Generate capture plans (tick + POV sampling)
- `scripts/capture_screenshots.py` — Drive CS2 demo playback to capture JPEGs

**Files staying in chimera:**
- `src/data/manifest.py` — chimera-specific data manifest
- `src/rewards.py` — GRPO reward functions
- `scripts/` training-related scripts (future)
- `site/` — stays in chimera even after viewer extraction

**Key issues:**
- `parse_demos.py` imports `src.data.manifest` — needs conditional import for standalone use
- `netcon.py` has no chimera-specific imports, cleanest to extract
- `capture_screenshots.py` and `plan_captures.py` depend on `netcon.py` (internal import)
- awpy + polars are heavy deps only needed for parse/export, should be optional in cs2-tools

### Pipeline status
- [ ] T01 — Inventory tools and fix imports
- [ ] T02 — Create cs2-tools repo and copy files
- [ ] T03 — Add pyproject.toml with optional deps
- [ ] T04 — Write README for cs2-tools
- [ ] T05 — Clean up chimera repo references

---

## Decision logging convention

All significant technical decisions go in `docs/decisions.md` with sequential IDs (D001, D002, ...). Each entry includes: decision, rationale, alternatives considered, and status. Check current decision count with:

```bash
grep -c '^## D[0-9]' docs/decisions.md
```
